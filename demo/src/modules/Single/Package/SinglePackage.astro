---
import DemoLoader from 'src/components/Demo/DemoLoader.astro';
import type { Package } from 'src/packages-loader';
// BUG: THIS BREAK (https://github.com/withastro/prettier-plugin-astro/issues/232)
// import { Code } from '___/components';
import Table from 'src/components/Table/Table.astro';

interface Props {
  content: Package;
}
const props = Astro.props as Props;
/* ———————————————————————————————————————————— Typeguards + Fallbacks —————— */
if (typeof props?.content?.readme?.Content !== 'function') {
  props.content = null;
}
/* —————————————————————————————————————————————————————————————————————————— */

// FIXME: correct astro type for MD content
const ReadMe = props?.content?.readme?.Content;
---

<div class='single-package'>
  {props.content ? (
    <>
      {props.content.hasDemo && (
        <section id="live-demo" class="package-section article-body">
          <h2>Component live demo</h2>

          <DemoLoader name={props.content.shortname} />
        </section>
      )}

      {props.content.video && (
        <section id="test-video" class="package-section article-body">
          <h2>Test x Demo : Video</h2>

          <div>
            <video width="100%" height="100%" controls autoplay loop>
              <source src={props.content.video} type="video/mp4" />
            </video>
          </div>
        </section>
      )}

      {ReadMe && (
        <section id="doc" class="package-section article-body">
          <ReadMe />
        </section>
      )}

      {props.content.api && (
        <section id="ts-api" class="package-section article-body">
          <h2>TypeScript API</h2>

          {props.content.api.extends && (
            <p>
              Extends: <code>{props.content.api.extends}</code>
            </p>
          )}

          <Table data={props.content.api.properties} class="api-props" />
        </section>
      )}

      {/* props.content.typescriptProps && (
        <section id="ts-api" class="package-section article-body">
      
          <h2>TypeScript API</h2>
          <Code code={props.content.typescriptProps} lang="tsx"/>
    
        </section>
      ) */}
    </>
  ) : (
    <div>Empty content — No README.md found</div>
  )}
</div>

<style lang='scss'>
  @import './SinglePackage.scss';
</style>
