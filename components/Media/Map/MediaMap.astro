---
export interface Props {
  /**
   * Longitude
   * */
  x: number;
  /**
   * Latitude
   * */
  y: number;
  /**
   * Zoom level
   *
   * **Default**: `10`
   * */
  z?: number;

  /**
   * CSS Unit
   * */
  height: string;
  /**
   * CSS Unit
   *
   * **Default**: `'100%'`
   * */
  width?: string;

  /**
   * **Default**: `true`
   * */
  attribution?: boolean;
}
const props = { ...Astro.props } as Props;

if (typeof props.x !== 'number') {
  props.x = 10;
  console.warn('> Missing `x` property for <MediaMap>');
}
if (typeof props.y !== 'number') {
  props.y = 10;
  console.warn('> Missing `y` property for <MediaMap>');
}
if (typeof props.z !== 'number') {
  props.z = 10;
}
if (typeof props.height !== 'string') {
  props.height = '12rem';
  console.warn('> Missing `height` property for <MediaMap>');
}
if (typeof props.width !== 'string') {
  props.width = '100%';
}
if (typeof props.attribution !== 'boolean') {
  props.attribution = true;
}
---

<div
  style={`z-index: 0; width: ${props.width}; height: ${props.height}`}
  id='map'
  data-x={props.x}
  data-y={props.y}
  data-z={props.z}
>
</div>

<script>
  import Leaflet from 'leaflet';
  // ONE MAP PER PAGE (for now)
  const mapElem = document.getElementById('map');

  if (mapElem) {
    const map = Leaflet.map('map', {
      center: [mapElem.getAttribute('data-x'), mapElem.getAttribute('data-y')],
      zoom: mapElem.getAttribute('data-z') || 14,
      scrollWheelZoom: false,
    });

    // FUTURE OPTION : Choose map tiles provider
    // const mapAccessToken = `import.meta.env.PUBLIC_MAP_TILER_ACCESS_TOKEN`;
    // const mapId = 'topographique';
    // const mapImgFormat = 'png';
    // const url = `https://api.maptiler.com/maps/${mapId}/256/{z}/{x}/{y}{r}.${mapImgFormat}?key=${mapAccessToken}`;
    // const url = 'http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png';
    const url = 'http://{s}.tile.osm.org/{z}/{x}/{y}.png';

    const layer = new Leaflet.TileLayer(url);
    map.addLayer(layer);
  }
</script>

<style
  lang='scss'
  is:global
  define:vars={{ display: props.attribution ? 'initial' : 'none' }}
>
  @import 'leaflet';

  .leaflet-control-attribution {
    display: var(--display, 'initial');
  }
</style>
